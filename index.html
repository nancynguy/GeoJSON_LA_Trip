<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8" />
  <title>My Map — Index</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js"></script>
  <style>
    /* Fullscreen map */
    html, body { height: 100%; margin: 0; }
    #map { position: absolute; inset: 0; } /* fills the whole window */

    /* Right “hovering” side panel */
    #side-panel {
      position: absolute;
      top: 0;
      right: 0;
      width: 420px;
      max-width: 95vw;
      height: 100%;
      background: rgba(255,255,255,0.92);
      border-left: 1px solid #ddd;
      padding: 12px;
      overflow: auto;
      box-sizing: border-box;
    }

    /* Table basics */
    table { width: 100%; border-collapse: collapse; border-spacing: 0; border: 1px solid #ddd; }
    th, td { text-align: left; padding: 12px; }
    tr:nth-child(even) { background-color: #f2f2f2; }

    /* Hide side panel when width < 1024px */
    @media (max-width: 1024px) {
      #side-panel { display: none; }
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <div id="side-panel">
    <h2>Nancy's 2025 Summer LA Trip</h2>
    <button id="sortBtn">Sort By Highest to Lowest Ranking</button>
    <table id="dataTable">
      <tr>
        <th>Place</th>
        <th>Activity</th>
        <th>Ranking</th>
      </tr>
    </table>
  </div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibmFuY3kzMjQiLCJhIjoiY21oMTEyejlmMDY1YzJycHVwYXVyZ2U1ZiJ9.YSOrhRs2Nuc7-00ALC3Q_w';
    const map = new mapboxgl.Map({
      container: 'map',
      // Different map style added here
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [-118.003589, 33.893174], // Zooms in on LA
      zoom: 9.25
    });

    // Fetch my LA trip data
    async function loadData() {
    const pointsResp = await fetch('assets/la_summer_trip_points.geojson');
    const points = await pointsResp.json();

    const zonesResp = await fetch('assets/la_summer_itinerary.geojson');
    const zones = await zonesResp.json();

    return { points, zones };
    }

loadData().then(({ points, zones }) => {
      map.on('load', () => {
    // --- Add POINTS layer ---
    map.addSource('tripPoints', {
      type: 'geojson',
      data: points
    });

    map.addLayer({
      id: 'tripPointsLayer',
      type: 'circle',
      source: 'tripPoints',
      paint: {
        'circle-radius': 6,
        'circle-color': '#ff66cc',   // Pink Points!
        'circle-stroke-width': 1.5,
        'circle-stroke-color': '#fff'
      }
    });

    // Create the table in the right panel 
    const table = document.getElementById("dataTable");

    // Add rows for each place in the points file
    points.features.forEach((feature) => {
      const props = feature.properties;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${props.name || "Unnamed"}</td>
        <td>${props.activity || "—"}</td>
        <td>${props.rating || "—"}</td>
      `;
      table.appendChild(row);
    });

    // Sort table by rating when button is clicked
    const btn = document.getElementById("sortBtn");
    btn.addEventListener("click", () => {
      const rows = Array.from(table.querySelectorAll("tr")).slice(1);
      rows.sort((a, b) => {
        const aVal = parseFloat(a.children[2].textContent) || 0;
        const bVal = parseFloat(b.children[2].textContent) || 0;
        return bVal - aVal; // highest rating first
      });
      rows.forEach(r => table.appendChild(r));
    });

    // Add POLYGONS layer 
    map.addSource('tripZones', {
      type: 'geojson',
      data: zones
    });

    map.addLayer({
      id: 'tripZonesLayer',
      type: 'fill',
      source: 'tripZones',
      paint: {
        'fill-color': '#66b3ff',
        'fill-opacity': 0.4,
        'fill-outline-color': '#3385ff'
      }
    });

    // Add popup for points
    map.on('click', 'tripPointsLayer', (e) => {
      const props = e.features[0].properties;
      const html = `<strong>${props.name}</strong><br>Activity: ${props.activity}<br>Rating: ${props.rating}`;
      new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML(html)
        .addTo(map);
    });

    // Add popup for polygons
    map.on('click', 'tripZonesLayer', (e) => {
      const props = e.features[0].properties;
      const html = `<strong>Day ${props.day}</strong><br>${props.theme}<br>${props.notes}`;
      new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML(html)
        .addTo(map);
    });
  });

});

  </script>
</body>
</html>

